# DEEP DIVE CH.24~

## CLOSURE 클로저

- 정의 : 함수와 그 함수가 선언된 렉시컬 환경과의 조합이다 (mdn)

- 중첩 함수가 아닌 경우는 해당 함수의 변수에 접근 불가능

## Lexical Environment

- 함수를 어디에 정했는지에 따라 상위 스코프를 결정하는 것(정적 스코프)

- 렉시컬 환경의 외부 렉시컬 환경에 대한 참조에 저장할 참조값을 결정한다. 

- 외부 렉시컬 환경에 대한 참조를 통해 상위 렉시컬 환경과 연결된다. 

- 렉시컬 스코프 : 외부 렉시컬 환경에 대한 참조에 저장할 참조값(상위 스코프)에 대한 참조는 함수 정의가 평가되는 시점에 함수가 정의된 환경에 의해 결정된다. 

## [[Environment]] 내부 슬롯

- 함수는 자신의 내부 슬롯 [[Environment]]에 자신이 정의된 환경, 즉 상위 스코프의 참조를 함수 정의가 평가되어 함수 객체를 생성할 때  저장한다.

- 자신의 내부 슬롯에 저장된 상위 스코프의 참조는 현재 실행 중인 실행 컨텍스트의 렉시컬 환경을 가리킨다. -> 함수 정의가 평가되어 함수 객체를 생성하는 시점은 함수가 정의된 환경, 상위 함수가 평가 또는 실행되고 있는 시점이며 실행 컨텍스트는 상위 함수의 실행 컨텍스트이기 때문. 

## 클로저

- 외부 함수보다 중첩 함수가 더 오래 유지되는 경우 중ㅎ첩 함수는 이미 생명 주기가 종료한 외부 함수의 변수를 참조할 수 있다. 

- 모든 함수는 자신의 상위 스코프를 기억한다. (저장된 상위 스코프는 함수가 존재하는 한 유지된다)

- 함수의 실행이 종료되면 함수의 생명주기가 종료되어 실행 컨텍스트 스택에서 제거된다. 이 때 outer 함수의 렉시컬 환경까지 소멸한는 것은 아니다.

- 중첩 함수가 외부 함수보다 오래 살아있을때 오래 생존한 중첩 함수는 외부 함수의 생존 여부와 상관없이 자신이 정의된 위치에 의해 결정된 상위 스코프를 기억한다. 이처럼 중첩 함수는 내부에서 상위 스코프를 참조할 수 있으므로, 상위 스코프의 식별자를 참조할 수 있으므로 상위 스코프의 식별자를 참조할 수 있고 식별자의 값을 변경할수도 있다.  
